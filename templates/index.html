<!DOCTYPE html>
<html lang="en">
<head>
    <title>Nick Ofcl Hosting Panel</title>
    <meta charset="utf-8">

    <!-- MOBILE FULL SCREEN -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <style>
        :root{
            --accent:#00ffcc;
        }

        *{box-sizing:border-box}

        body{
            margin:0;
            background:#0b0b0b;
            color:white;
            font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
            overflow-x:hidden;
            padding-bottom:65px;
        }

        /* BACKGROUND */
        #bg-canvas{
            position:fixed;
            inset:0;
            z-index:-1;
        }

        /* TOP BAR */
        .user-bar{
            position:sticky;
            top:0;
            z-index:10;
            background:rgba(10,10,10,.9);
            backdrop-filter:blur(12px);
            padding:12px 16px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            border-bottom:1px solid #222;
        }

        .logout-btn{
            background:#ff4d4d;
            color:white;
            text-decoration:none;
            padding:6px 14px;
            border-radius:8px;
            font-size:13px;
        }

        h1{
            text-align:center;
            color:var(--accent);
            margin:20px 10px;
            font-size:1.8em;
            text-shadow:0 0 12px var(--accent);
        }

        /* UPLOAD */
        .upload-section{
            padding:0 14px;
        }

        .upload-card{
            background:#121212;
            border:2px dashed var(--accent);
            border-radius:18px;
            padding:20px;
            text-align:center;
        }

        .file-label{
            display:block;
            padding:22px 10px;
            background:#0f0f0f;
            border-radius:14px;
            border:1px solid #333;
            cursor:pointer;
            margin-bottom:12px;
            font-size:14px;
        }

        .upload-btn{
            width:100%;
            padding:14px;
            border:none;
            border-radius:14px;
            background:var(--accent);
            color:black;
            font-weight:700;
            font-size:16px;
        }

        /* APP BOX */
        .box{
            background:#121212;
            border:1px solid #222;
            margin:16px 14px;
            padding:16px;
            border-radius:18px;
        }

        .status-running{color:#00ff66}
        .status-stopped{color:#ff4d4d}

        .button-group{
            display:grid;
            grid-template-columns:1fr 1fr;
            gap:10px;
            margin:12px 0;
        }

        .btn-large{
            padding:14px;
            border-radius:14px;
            border:none;
            font-weight:700;
            font-size:14px;
            width:100%;
        }

        .run{background:#1abc9c;color:black}
        .stop{background:#e74c3c;color:white}
        .restart{background:#f39c12;color:black}
        .delete{background:#555;color:white}

        pre{
            background:#000;
            border:1px solid #222;
            border-radius:14px;
            padding:12px;
            height:220px;
            overflow:auto;
            color:#00ff66;
            font-size:12px;
            margin-top:10px;
        }

        /* COLOR CONTROL */
        .color-control{
            position:fixed;
            right:10px;
            bottom:80px;
            background:#111;
            border:1px solid #222;
            padding:8px;
            border-radius:10px;
            z-index:20;
        }

        /* BOTTOM NAV */
        .bottom-nav{
            position:fixed;
            bottom:0;
            left:0;
            width:100%;
            background:#0f0f0f;
            border-top:1px solid #222;
            display:flex;
            z-index:10;
        }

        .bottom-nav div{
            flex:1;
            text-align:center;
            padding:10px 0;
            font-size:12px;
            color:#aaa;
        }

        .bottom-nav .active{
            color:var(--accent);
        }

        @media(min-width:768px){
            body{padding-bottom:0}
            .bottom-nav{display:none}
            .upload-section,.box{max-width:900px;margin:auto}
        }
    </style>
</head>
<body>

<canvas id="bg-canvas"></canvas>

<div class="user-bar">
    <span>üë§ {{ session['username'] }}</span>
    <a href="/logout" class="logout-btn">Logout</a>
</div>

<div class="color-control">
    <input type="color" id="accentColor" value="#00ffcc">
</div>

<h1>üñ• Nick Ofcl Hosting Panel</h1>

<div class="upload-section">
    <div class="upload-card">
        <h3>üì§ Upload ZIP Project</h3>
        <form method="POST" enctype="multipart/form-data">
            <input type="file" name="file" id="fileInput" accept=".zip" hidden required>
            <label for="fileInput" class="file-label" id="fileNameDisplay">
                Tap to select ZIP
            </label>
            <button class="upload-btn">Deploy</button>
        </form>
    </div>
</div>

{% for app in apps %}
<div class="box">
    <h3>
        üì¶ {{ app.name }} ‚Äî
        <span class="status-{{ 'running' if app.running else 'stopped' }}">
            {{ 'RUNNING' if app.running else 'STOPPED' }}
        </span>
    </h3>

    <div class="button-group">
        <a href="/run/{{ app.name }}"><button class="btn-large run">‚ñ∂ Run</button></a>
        <a href="/stop/{{ app.name }}"><button class="btn-large stop">‚èπ Stop</button></a>
        <a href="/restart/{{ app.name }}"><button class="btn-large restart">üîÑ Restart</button></a>
        <a href="/delete/{{ app.name }}" onclick="return confirm('Delete?')">
            <button class="btn-large delete">üóë Delete</button>
        </a>
    </div>

    <pre id="log-{{ app.name }}">{{ app.log if app.log else 'Waiting for logs...' }}</pre>
</div>
{% endfor %}

<div class="bottom-nav">
    <div class="active">Panel</div>
    <div>Logs</div>
    <div>Settings</div>
</div>

<script>
/* FILE NAME */
const f=document.getElementById('fileInput');
const d=document.getElementById('fileNameDisplay');
f.addEventListener('change',()=>{
    if(f.files.length) d.innerText="‚úÖ "+f.files[0].name;
});

/* COLOR */
const c=document.getElementById('accentColor');
c.addEventListener('input',e=>{
    document.documentElement.style.setProperty('--accent',e.target.value);
});

/* LOG AUTO UPDATE (OLD LOGIC SAFE) */
function updateLogs(){
    fetch('/')
    .then(r=>r.text())
    .then(html=>{
        const doc=new DOMParser().parseFromString(html,'text/html');
        {% for app in apps %}
        const n=doc.getElementById('log-{{ app.name }}');
        const o=document.getElementById('log-{{ app.name }}');
        if(n && o && o.innerHTML!==n.innerHTML){
            o.innerHTML=n.innerHTML;
            o.scrollTop=o.scrollHeight;
        }
        {% endfor %}
    });
}
setInterval(updateLogs,3000);

/* PARTICLE BG */
const canvas=document.getElementById('bg-canvas');
const ctx=canvas.getContext('2d');
let p=[];
function rs(){canvas.width=innerWidth;canvas.height=innerHeight}
addEventListener('resize',rs);rs();

class P{
    constructor(){
        this.x=Math.random()*canvas.width;
        this.y=Math.random()*canvas.height;
        this.vx=(Math.random()-.5)*.6;
        this.vy=(Math.random()-.5)*.6;
        this.s=Math.random()*2;
    }
    u(){
        this.x+=this.vx;this.y+=this.vy;
        if(this.x<0||this.x>canvas.width) this.vx*=-1;
        if(this.y<0||this.y>canvas.height) this.vy*=-1;
    }
    d(){
        ctx.fillStyle=c.value;
        ctx.beginPath();
        ctx.arc(this.x,this.y,this.s,0,Math.PI*2);
        ctx.fill();
    }
}
for(let i=0;i<70;i++) p.push(new P());
(function a(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    p.forEach(x=>{x.u();x.d()});
    requestAnimationFrame(a);
})();
</script>

</body>
</html>
